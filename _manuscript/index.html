<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Paper Review</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>


<meta name="citation_title" content="Paper Review">
<meta name="citation_author" content="Shauna Heron">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Combining clinical notes with structured electronic health records enhances the prediction of mental health crises;,citation_author=Roger Garriga;,citation_author=Teodora Sandra Buda;,citation_author=João Guerreiro;,citation_author=Jesús Omaña Iglesias;,citation_author=Iñaki Estella Aguerri;,citation_author=Aleksandar Matić;,citation_publication_date=2023-11-21;,citation_cover_date=2023-11-21;,citation_year=2023;,citation_fulltext_html_url=https://www.cell.com/cell-reports-medicine/abstract/S2666-3791(23)00437-8;,citation_issue=11;,citation_doi=10.1016/j.xcrm.2023.101260;,citation_volume=4;,citation_language=en-US;,citation_journal_title=Cell Reports Medicine;">
<meta name="citation_reference" content="citation_title=Addressing urgent workforce challenges in child and youth mental health;,citation_author=undefined CMHO;,citation_publication_date=2022-03;,citation_cover_date=2022-03;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=Machine learning model to predict mental health crises from electronic health records;,citation_author=Roger Garriga;,citation_author=Javier Mas;,citation_author=Semhar Abraha;,citation_author=Jon Nolan;,citation_author=Oliver Harrison;,citation_author=George Tadros;,citation_author=Aleksandar Matic;,citation_publication_date=2022-06;,citation_cover_date=2022-06;,citation_year=2022;,citation_fulltext_html_url=https://www.nature.com/articles/s41591-022-01811-5;,citation_issue=6;,citation_doi=10.1038/s41591-022-01811-5;,citation_volume=28;,citation_language=en;,citation_journal_title=Nature Medicine;">
<meta name="citation_reference" content="citation_title=Measuring Performance: AUPRC and Average Precision;,citation_publication_date=2019-03-02;,citation_cover_date=2019-03-02;,citation_year=2019;,citation_fulltext_html_url=https://glassboxmedicine.com/2019/03/02/measuring-performance-auprc/;,citation_language=en;">
<meta name="citation_reference" content="citation_title=Machine Learning / Deep Learning - Classifier Evaluation Slides;,citation_author=Meng Cheng Lau;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_language=en;,citation_publisher=Laurentian University;">
<meta name="citation_reference" content="citation_title=Machine Learning / Deep Learning - Neural Network Slides;,citation_author=Meng Cheng Lau;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_language=en;,citation_publisher=Laurentian University;">
<meta name="citation_reference" content="citation_title=BERT 101 - state of the art NLP model explained;,citation_fulltext_html_url=https://huggingface.co/blog/bert-101;">
<meta name="citation_reference" content="citation_title=Welcome to the SHAP documentation  SHAP latest documentation;,citation_fulltext_html_url=https://shap.readthedocs.io/en/latest/;">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Paper Review</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Author</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Shauna Heron </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Laurentian University
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      <div class="quarto-alternate-formats"><div class="quarto-title-meta-heading">Other Formats</div><div class="quarto-title-meta-contents"><p><a href="index.pdf"><i class="bi bi-file-pdf"></i>Typst</a></p></div></div></div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="Presentation-1-preview.html"><i class="bi bi-journal-code"></i>Untitled</a></li></ul></div></div>
<main class="content quarto-banner-title-block" id="quarto-document-content">



  


<section id="introduction-and-motivation" class="level1">
<h1><strong>Introduction and Motivation</strong></h1>
<p>This review analyzes a study by <span class="citation" data-cites="garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a></span>, published in <em>Cell Medical</em>, titled <em>“Combining Clinical Notes with Structured Electronic Health Records Enhances the Prediction of Mental Health Crises.”</em></p>
<p>The research investigates the utility of combining unstructured clinical notes with structured data from electronic health records (EHR) to improve the prediction of mental health crises <span class="citation" data-cites="garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a></span>. The relevance of this research is underscored by a global rise in mental health-related hospitalizations coinciding with significant workforce challenges, stressing the need for tools that might anticipate demand which is necessary to manage caseloads more efficiently. Even in Ontario, recent data highlights that hospitalizations for mental health conditions, particularly among youth, have surged since the COVID-19 pandemic <span class="citation" data-cites="addressi2022"><a href="#ref-addressi2022" role="doc-biblioref">[2]</a></span>. Moreoever, those requiring hospitalization (e.g., emotional breakdowns, substance overdoses and suicide attempts) have increased by 90% <span class="citation" data-cites="addressi2022"><a href="#ref-addressi2022" role="doc-biblioref">[2]</a></span>–many of which many might have been prevented with early intervention, suggesting that an automated tool for predicting crisis onset might help anticipate and address mental health crises before they peak.</p>
<p>As the authors point out, leveraging EHRs to bolster clinical decision-making is not new <span class="citation" data-cites="garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a></span>. Clinicians and researchers have long utilized structured data like diagnosis codes, lab results, and medication records to inform predictive models. However, computational limits as well as a lack of sophisticated modeling tools necessary to implement such models mean that unstructured data like clinical notes and other free-form text, are most often left out of feature sets, despite the rich contextual information that clinical notes contain.</p>
</section>
<section id="hybrid-solution" class="level1">
<h1><strong>Hybrid Solution</strong></h1>
<p>With this gap in mind, the authors proposed a hybrid solution that built on their previous study <span class="citation" data-cites="garriga2022"><a href="#ref-garriga2022" role="doc-biblioref">[3]</a></span> that leveraged structured EHRs to predict crisis events with a weekly crisis-risk score. In the current study, they included unstructured data in the form of clinical notes to bolster those predictions. Specifically, the author’s hypothesized that models that combined structured and unstructured data (such as clinical notes) would predict the probability of a weekly crisis event more accurately than a model including just structured data alone.</p>
<p>Structured data features included static features like demographic information (e.g., postal code, race, gender), features that described the patients most recent interaction with the hospital (e.g., substance use identified, new medication), and lag-features that quantified the elapsed time since a specific event (e.g., time since the last crisis episode). Unstructured data was made up of free-form clinical notes written by clinicians. From these notes, semantic features were created using a BERT model, which is a pre-trained model good at extracting enhanced language features by considering the words that come before and after each word in a sentence <span class="citation" data-cites="bert101"><a href="#ref-bert101" role="doc-biblioref">[4]</a></span>.</p>
<p>Leveraging those features, four models were trained to predict the risk of relapse within a 28-day window as a binary classification (relapse versus no relapse): i) a deep neural network trained on structured data (referred to as Struct DNN), ii) a model trained exclusively on unstructured data (Text DNN), iii) a hybrid model that integrated both structured and unstructured data (Hybrid DNN) and importantly, iv) an ensemble of models that utilized predictions from the Hybrid DNN when unstructured data was available and predictions from the Struct DNN model otherwise (referred to as Ensemble DNN). See Figure 1 below for a flow chart of the experimental and modeling process.</p>
<p><strong>Model Architecture and Data Flow Diagram:</strong></p>
<p><img src="images/paste-1.png" class="img-fluid" alt="Figure: Model Architecture"> Figure 1. Overview of the Hybrid DNN model and data input structure, showing how structured and unstructured data are processed. Adapted from <span class="citation" data-cites="garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a>, pg. 3</span></p>
<p>To address the issue of class imbalance (since crisis relapses are rare with only 1.3% prevalence), models were tuned to maximize the area under the precision-recall curve (AUPRC)–which as we learned in class is a particularly useful metric when evaluating results produced by imbalanced classes. Moreoever, as highlighted in our lessons, precision-recall metrics provide a better measure of a model’s predictive quality than accuracy in healthcare settings where false positives can be just as costly as false negatives <span class="citation" data-cites="mc2024 garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a>, <a href="#ref-mc2024" role="doc-biblioref">[5]</a></span>.</p>
<p>To evaluate model performance against non-machine learning methods used to evaluate crisis-risk, two baselines were built: a 5-factor logistic regression model informed by significant variables suggested in prior literature (LogReg5) and a heuristic model that ranked patients by the total number of crises they had experienced in the past year <span class="citation" data-cites="garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a></span>.</p>
</section>
<section id="results" class="level1">
<h1><strong>Results</strong></h1>
<p>The experiments revealed that the best performing model trained on structured data alone was an XGBoost classifier, a tree-based model implementing gradient boosting. The best performing model on unstructured data alone as well as combined structured and unstructured data was a feed-forward deep neural network (DNN). The best performing model overall was the ensemble DNN that took a flexible approach, utilizing predictions from a structured DNN when unstructured data was unavailable and the hybrid DNN combining data types when it was enabling the model to draw insights from semantic features when available to increase overall performance.</p>
<p>Interestingly, the authors also examined the impact that various features in the models had on predictive performance with Shapley additive explanations (SHAP). Their use of SHAP to assess the predictive power of different types of data as well as different features is significant because it increases model interpretability and transparency which is important in healthcare settings were decisions need to be trusted by front line staff. Though an in depth discussion of SHAP analysis is beyond the scope of this review, it is worth noting that the authors implemented it; allowing for both cohort-level and instance-specific explanations for predictions <span class="citation" data-cites="welcome"><a href="#ref-welcome" role="doc-biblioref">[6]</a></span>.</p>
<section id="performance-comparison-across-models" class="level2">
<h2 class="anchored" data-anchor-id="performance-comparison-across-models"><strong>Performance Comparison Across Models:</strong></h2>
<p>The comparative performance of the Structured-XGBoost, unstructured DNN and the hybrid DNN combining data types at 10-week intervals across the 52 weeks are illustrated in the figure below. The increase in area under the precision-recall curves (AUPRC) over time suggests an increase in performance across models at each 10-week interval <span class="citation" data-cites="measurin2019"><a href="#ref-measurin2019" role="doc-biblioref">[7]</a></span>.</p>
<p>According to the authors, the increase in AUPRC over time is only weakly related to an increase in EHR data over time, and more to the clinical fact that the chance of a crisis-relapse increases the longer a patient is in treatment. The structured XGBoost model outperformed both models at 10-weeks, but at 20 weeks, when clinical note data becomes available, the XGBoost model is surpassed by the hybrid model. Higher AUPRC values indicate better precision in predicting true crisis-events relative to non-crisis events that are incorrectly predicted.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/paste-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure: Precision-Recall Curves"><img src="images/paste-3.png" class="img-fluid figure-img" alt="Figure: Precision-Recall Curves"></a></p>
<figcaption>Figure: Precision-Recall Curves</figcaption>
</figure>
</div>
<p><em>Figure 3. Precision-recall curves for the Hybrid DNN, Struct DNN, and Text DNN, across 10-week intervals illustrating an increase in performance of all models over time as the amount of information increases across weeks. Adapted from <span class="citation" data-cites="garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a>, pg. 5</span></em></p>
<p>The receiver operating characteristic (AUROC) comparisons below, similarly reflect the model’s ability to distinguish between true positive and negative predictions, however AUROC is considered a more forgiving metric when evaluating imbalanced datasets because it measures the model’s overall capacity to separate classes, rather than focusing exclusively on predicting positive classes (crisis events). As indicated in Figure 4, the ability of both the structured XGBoost and unstructured DNN models to distinguish between classes <em>decrease</em> over time until 40 weeks when both the structured and hybrid model increase in performance. Interestingly, the performance of the unstructured-only model decreases across the entire 52 weeks, which the authors suggest highlights the complexity of modelling mental health crises: while the quantity of data in a given client file tends to increase over time, the overall number of patients requiring treatment <em>decreases</em> which impacts performance of the neural network (i.e., text input tends to require more examples or training instances to perform adequately in NNs) <span class="citation" data-cites="garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a></span>. Note too how the structured-only xgboost is best at predicting crisis with fewer than 10% of notes, but with 20% of weeks with available notes, the hybrid model’s performance offers a small improvement on performance. This indicates that the addition of unstructured data helped the model make more accurate predictions across a range of thresholds, improving its overall discriminatory power.</p>
<p><strong>AUROC Across 52 weeks:</strong></p>
<p><img src="images/paste-4.png" class="img-fluid" alt="Figure: Model Accuracy"> <em>Figure 4. Performance of the Hybrid model compared to the unstructured and structured only models in predicting crisis episodes at 10 week intervals. Points and lines indicate mean and ± standard deviation values computed in the 52 weeks of the test set. Adapted from <span class="citation" data-cites="garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a>, pg. 5</span></em></p>
</section>
</section>
<section id="critical-analysis" class="level1">
<h1><strong>Critical Analysis</strong></h1>
<p>The paper offered a compelling case for the inclusion of unstructured data to bolster structured data in predictive modeling of healthcare data, highlight several important techniques including the use of an ensemble of models depending on the data available as well as demonstrating the importance of feature analysis which allows both cohort-level and instance-specific explanations which is important for enhancing transparency in healthcare machine learning models. There were several areas that to keep in mind. which supported their hypothesis that incorporating clinical notes would improve the model’s ability to identify potential mental health crises earlier compared to models trained on structured data alone.</p>
<p>While the best model achieved notable AUPRC and AUROC scores in the context of predicting a rare event like a mental health crises, the results still reflect a gap between predictive performance and the reliability needed for clinical decision-making. The scores tells us that while the model can identify crises better than random guessing, it may still flag many non-crisis events potentially overburdening clinicians. It would have been interesting to discuss what a threshold for clinical utility would be in any implementations. Nevertheless, the authors did point out difficulties inherent in utilizing clinical data to predict rare events–as the probability of an event decreases over time within a cohort, the number of people in that cohort will decrease.</p>
<p>SImilarly, though the author’s conducted a robust feature analysis which is important for enhancing transparency in healthcare machine learning models, the contribution of specific unstructured features remained somewhat opaque. Nevertheless, ….</p>
<p>Moreoever, the model was trained on a single healthcare setting’s data, which means there could be challenging generalizing to another setting with different populations or documentation practices. Future research could explore the generalizability of these findings to other domains within healthcare. In particular, in my own research I am wondering how this method could be used to predict case complexity to caseload management. and refine <span class="citation" data-cites="garriga2023"><a href="#ref-garriga2023" role="doc-biblioref">[1]</a></span> ’s approach to make the integration of unstructured data more interpretable. Another potential direction was improving methods for natural language processing (NLP) to better extract meaningful insights from clinical notes, which could further enhance predictive performance.</p>
<p>I especially liked their inclusion of SHAP values and analyses of variables that contributed most to model predictions–TALK MORE ABOUT THIS.</p>
<p>Secondly, the study primarily focused on a single health system, which might limit the generalizability of the results. Future studies should consider multi-site evaluations to determine if the predictive power of these models held in different settings with varied data quality and clinical practices.</p>
<p>Lastly, while the results were promising, they relied heavily on high-quality, well-documented clinical notes. In practice, the quality of clinical notes could vary significantly, and the models’ reliance on unstructured data could lead to inconsistencies in predictions if the notes were incomplete or ambiguous.</p>
</section>
<section id="conclusion" class="level1">
<h1><strong>Conclusion</strong></h1>
<p>The study effectively demonstrated that incorporating unstructured data, such as clinical notes, alongside structured EHR data improved the ability to predict mental health crises. Importantly their findings underscore the potential for including qualitative clinical information in predictive modeling and highlights a novel ensemble methodology that can be used to build a flexible, combined model that can extract value from both data types. depening on what is available in the client record.</p>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-garriga2023" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">R. Garriga, T. S. Buda, J. Guerreiro, J. O. Iglesias, I. E. Aguerri, and A. Matić, <span>“Combining clinical notes with structured electronic health records enhances the prediction of mental health crises,”</span> <em>Cell Reports Medicine</em>, vol. 4, no. 11, Nov. 2023, doi: <a href="https://doi.org/10.1016/j.xcrm.2023.101260">10.1016/j.xcrm.2023.101260</a>.</div>
</div>
<div id="ref-addressi2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">CMHO, <span>“Addressing urgent workforce challenges in child and youth mental health,”</span> Mar. 2022.</div>
</div>
<div id="ref-garriga2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">R. Garriga <em>et al.</em>, <span>“Machine learning model to predict mental health crises from electronic health records,”</span> <em>Nature Medicine</em>, vol. 28, no. 6, pp. 1240–1248, Jun. 2022, doi: <a href="https://doi.org/10.1038/s41591-022-01811-5">10.1038/s41591-022-01811-5</a>.</div>
</div>
<div id="ref-bert101" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline"><span>“BERT 101 - state of the art NLP model explained.”</span> Available: <a href="https://huggingface.co/blog/bert-101">https://huggingface.co/blog/bert-101</a></div>
</div>
<div id="ref-mc2024" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">M. C. Lau, <span>“Machine Learning / Deep Learning - Neural Network Slides.”</span> Laurentian University, 2024.</div>
</div>
<div id="ref-welcome" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div class="csl-right-inline"><span>“Welcome to the SHAP documentation <span></span> SHAP latest documentation.”</span> Available: <a href="https://shap.readthedocs.io/en/latest/">https://shap.readthedocs.io/en/latest/</a></div>
</div>
<div id="ref-measurin2019" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div class="csl-right-inline"><span>“Measuring Performance: AUPRC and Average Precision.”</span> Mar. 02, 2019. Available: <a href="https://glassboxmedicine.com/2019/03/02/measuring-performance-auprc/">https://glassboxmedicine.com/2019/03/02/measuring-performance-auprc/</a></div>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","loop":false,"openEffect":"zoom","selector":".lightbox","descPosition":"bottom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>